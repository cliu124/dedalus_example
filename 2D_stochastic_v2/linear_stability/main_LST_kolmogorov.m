clear all;close all;clc;Lx=2*pi;%horizontal domainLz=4*pi;%vertical domain, note I use z to denote vertical domain!!!kz_list=2*pi/Lz*linspace(1,10,10);%this are the wavenumbers resolved in the vertical domain 2pi/alphaRe_list=0.1+2^(1/4)*(1+3*(2*pi/Lz)^2/4);%Reynolds number, this is based on stability criteria in equation (3.1) of Lucas & Kerswell (2014). Note that I choose n=1 in  their formula to simplify Nx=128;%resolution of numerical discretization of horizontal direction%%--------Below do not need to be modified. ky_list=0;[x_2pi,D1x_2pi] = fourdif(Nx,1);%get Fourier differential matrix, note this is based on 2pi domain[~,D2x_2pi] = fourdif(Nx,2);[~,D4x_2pi] = fourdif(Nx,4);I=eye(Nx,Nx);O=zeros(Nx,Nx);x=x_2pi/2/pi*Lx;%Rescale the x domain to the specified domainD1x=D1x_2pi*2*pi/Lx;D2x=D2x_2pi*(2*pi/Lx)^2;D4x=D4x_2pi*(2*pi/Lx)^4;%%------Above do not need to be modified%%------Below is setting up the mean floww_amp=Re_list;%mean flow amplitudekx_mean=2*pi/Lx;%mean flow wavenumberW_mean=w_amp*cos(kx_mean*x);%mean flow,d_W_mean=-w_amp*kx_mean*sin(kx_mean*x);%first order derivate of mean flowdd_W_mean=-w_amp*kx_mean^2*cos(kx_mean*x);%second order derivative of mean flow%%-----Above is setting up the mean flow%%------Below do not need to be modified. for Re_ind=1:length(Re_list)    Re=Re_list(Re_ind);    for ky_ind=1:length(ky_list)        ky=ky_list(ky_ind);        for kz_ind=1:length(kz_list)            kz=kz_list(kz_ind);            Laplacian=D2x-(ky^2+kz^2)*I;            %below is the formulation using velocity vorticity ones            Laplacian_square=D4x-2*(ky^2+kz^2)*D2x+(ky^2+kz^2)^2*I;            Laplacian_inv=pinv(Laplacian);            A11=Laplacian_inv*(-1i*kz*diag(W_mean)*Laplacian+1i*kz*diag(dd_W_mean)+1/Re*Laplacian_square);            A12=O;            A21=-1i*ky*diag(d_W_mean);            A22=-1i*kz*diag(W_mean)+1/Re*Laplacian;            A=[A11,A12;                A21,A22];            M=blkdiag(I,I);            [eig_vec,eig_val]=eig(A,M);            eig_val=diag(eig_val);            eig_val(find(real(eig_val)==Inf))=-Inf;            [growth_rate(Re_ind,ky_ind,kz_ind),max_ind]=max(real(eig_val));            eig_val_max{Re_ind,ky_ind,kz_ind}=eig_val(max_ind);            eig_vec_max{Re_ind,ky_ind,kz_ind}=eig_vec(:,max_ind);        end        [~,kz_max_ind]=max(squeeze(growth_rate(Re_ind,ky_ind,:)));        [~,kz_0_ind]=min(squeeze(abs(growth_rate(Re_ind,ky_ind,3:end))));%This will get rid of the first two points that always gives growth rate close to zero     endendplot(squeeze(growth_rate));